###############################################################################
#
# IAR ANSI C/C++ Compiler V8.40.2.214/W32 for ARM         24/Jul/2020  17:33:58
# Copyright 1999-2019 IAR Systems AB.
#
#    Cpu mode     =  
#    Endian       =  little
#    Source file  =
#        E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\user\src\timer.c
#    Command line =
#        -f C:\Users\Evan\AppData\Local\Temp\EWB710.tmp
#        (E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\user\src\timer.c
#        -D USE_STDPERIPH_DRIVER -D STM32F429_439xx -lC
#        E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\Debug\List
#        -o
#        E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\Debug\Obj
#        --no_cse --no_unroll --no_inline --no_code_motion --no_tbaa
#        --no_clustering --no_scheduling --debug --endian=little
#        --cpu=Cortex-M4 -e --fpu=None --dlib_config "D:\IAR Systems\Embedded
#        Workbench 8.3\arm\inc\c\DLib_Config_Normal.h" -I
#        E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\..\STM32F4xx_DSP_StdPeriph_Lib_V1.8.0\Libraries\CMSIS\Device\ST\STM32F4xx\Include\
#        -I
#        E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\..\STM32F4xx_DSP_StdPeriph_Lib_V1.8.0\Libraries\CMSIS\Device\ST\STM32F4xx\Source\Templates\
#        -I
#        E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\..\STM32F4xx_DSP_StdPeriph_Lib_V1.8.0\Libraries\CMSIS\Device\ST\STM32F4xx\Source\Templates\iar\
#        -I
#        E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\..\STM32F4xx_DSP_StdPeriph_Lib_V1.8.0\Libraries\STM32F4xx_StdPeriph_Driver\inc\
#        -I
#        E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\..\STM32F4xx_DSP_StdPeriph_Lib_V1.8.0\Libraries\STM32F4xx_StdPeriph_Driver\src\
#        -I
#        E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\user\inc\
#        -I
#        E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\user\src\
#        -Ol --use_c++_inline -I "D:\IAR Systems\Embedded Workbench
#        8.3\arm\CMSIS\Core\Include\" -I "D:\IAR Systems\Embedded Workbench
#        8.3\arm\CMSIS\DSP\Include\")
#    Locale       =  C
#    List file    =
#        E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\Debug\List\timer.lst
#    Object file  =
#        E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\Debug\Obj\timer.o
#
###############################################################################

E:\STM32Project\Cubli_with_STM32F429\Cubli-with-STM32F429\Cubli\user\src\timer.c
      1          #include "timer.h"
      2          

   \                                 In section .bss, align 4
      3          uint32_t running_tim_cnt = 0;
   \                     running_tim_cnt:
   \        0x0                      DS8 4
      4          

   \                                 In section .data, align 4
      5          int Max_Pwm = 8300;
   \                     Max_Pwm:
   \        0x0   0x0000'206C        DC32 8'300

   \                                 In section .bss, align 4
      6          int flag_stop = 0 ;
   \                     flag_stop:
   \        0x0                      DS8 4

   \                                 In section .data, align 4
      7          int Velocity_KP = 200;//120; //155 100 300 150  150 
   \                     Velocity_KP:
   \        0x0   0x0000'00C8        DC32 200

   \                                 In section .bss, align 4
      8          int Velocity_KI = 0.65;//80; //80 200 200   80   40
                                   ^
Warning[Pa092]: implicit conversion to integer does not preserve the value
   \                     Velocity_KI:
   \        0x0                      DS8 4

   \                                 In section .data, align 4
      9          int Balance_KP =800;//860;//890;//852;// 1700  2000 501 401 401     401  410 430(4.5) 500 970 1120
   \                     Balance_KP:
   \        0x0   0x0000'0320        DC32 800

   \                                 In section .data, align 4
     10          float Balance_Ki = 0.02;//0.035; // 0.2 
   \                     Balance_Ki:
   \        0x0   0x3CA3'D70A        DC32 0x3ca3'd70a

   \                                 In section .data, align 4
     11          float Balance_KD = 66.2;//63.2;//582;// 1000  1200  90 40  180 155 150 350 380  400 572 610
   \                     Balance_KD:
   \        0x0   0x4284'6666        DC32 0x4284'6666

   \                                 In section .bss, align 4
     12          float velocity_pwm_x = 0.0;
   \                     velocity_pwm_x:
   \        0x0                      DS8 4

   \                                 In section .bss, align 4
     13          int balance_pwm_x = 0;
   \                     balance_pwm_x:
   \        0x0                      DS8 4

   \                                 In section .bss, align 4
     14          int PWM_X = 0;
   \                     PWM_X:
   \        0x0                      DS8 4

   \                                 In section .bss, align 4
     15          int nvic_flag=0;
   \                     nvic_flag:
   \        0x0                      DS8 4
     16          

   \                                 In section .bss, align 4
     17          int encoder_x;
   \                     encoder_x:
   \        0x0                      DS8 4

   \                                 In section .bss, align 4
     18          int encoder_y;
   \                     encoder_y:
   \        0x0                      DS8 4

   \                                 In section .bss, align 4
     19          int encoder_z;
   \                     encoder_z:
   \        0x0                      DS8 4
     20          /*===============================
     21          
     22          測試系統運行時間
     23          
     24          ===============================*/

   \                                 In section .text, align 2, keep-with-next
     25          void time_check(_Time_test *running)
     26          {
   \                     time_check: (+1)
   \        0x0   0xB510             PUSH     {R4,LR}
   \        0x2   0x0004             MOVS     R4,R0
     27            running->last_time_us = running->now_time_us;
   \        0x4   0x6860             LDR      R0,[R4, #+4]
   \        0x6   0x6020             STR      R0,[R4, #+0]
     28            running->now_time_us = running_tim_cnt * 5000 + TIM5->CNT;                  //計數累加數加1，则需要5ms = 5000us ，定時器定時5ms需要5000次計數，所以一次CNT值為1us 
   \        0x8   0x....             LDR.N    R0,??DataTable5
   \        0xA   0x6800             LDR      R0,[R0, #+0]
   \        0xC   0xF241 0x3288      MOVW     R2,#+5000
   \       0x10   0x....             LDR.N    R1,??DataTable5_1  ;; 0x40000c24
   \       0x12   0x6809             LDR      R1,[R1, #+0]
   \       0x14   0xFB02 0x1000      MLA      R0,R2,R0,R1
   \       0x18   0x....'....        BL       __aeabi_ui2f
   \       0x1C   0x6060             STR      R0,[R4, #+4]
     29            running->delta_time_us = running->now_time_us - running->last_time_us;
   \       0x1E   0x6860             LDR      R0,[R4, #+4]
   \       0x20   0x6821             LDR      R1,[R4, #+0]
   \       0x22   0x....'....        BL       __aeabi_fsub
   \       0x26   0x60A0             STR      R0,[R4, #+8]
     30            running->delta_time_ms = running->delta_time_us * 0.001f;
   \       0x28   0x68A1             LDR      R1,[R4, #+8]
   \       0x2A   0x....             LDR.N    R0,??DataTable5_2  ;; 0x3a83126f
   \       0x2C   0x....'....        BL       __aeabi_fmul
   \       0x30   0x60E0             STR      R0,[R4, #+12]
     31            //printf("time interrupt is %f\n", running->delta_time_us);
     32          }
   \       0x32   0xBD10             POP      {R4,PC}          ;; return
     33          
     34          /*===============================
     35          
     36          PID
     37          
     38          ===============================*/

   \                                 In section .text, align 2, keep-with-next
     39          float control_velocity(int encoder){
   \                     control_velocity: (+1)
   \        0x0   0xB5F8             PUSH     {R3-R7,LR}
     40            static float Velocity,Encoder_Least,Encoder;
     41            static float Encoder_Integral;  
     42            //=============速度PI控制器=======================//	
     43            Encoder_Least=encoder;        
   \        0x2   0x....             LDR.N    R6,??DataTable5_3
   \        0x4   0x....'....        BL       __aeabi_i2f
   \        0x8   0x6030             STR      R0,[R6, #+0]
     44            Encoder *= 0.7;		                                                  
   \        0xA   0x....             LDR.N    R7,??DataTable5_4
   \        0xC   0x6838             LDR      R0,[R7, #+0]
   \        0xE   0x....'....        BL       __aeabi_f2d
   \       0x12   0xF05F 0x3266      MOVS     R2,#+1717986918
   \       0x16   0x....             LDR.N    R3,??DataTable5_5  ;; 0x3fe66666
   \       0x18   0x....'....        BL       __aeabi_dmul
   \       0x1C   0x....'....        BL       __aeabi_d2f
   \       0x20   0x6038             STR      R0,[R7, #+0]
     45            Encoder += Encoder_Least*0.3;	             
   \       0x22   0x6838             LDR      R0,[R7, #+0]
   \       0x24   0x....'....        BL       __aeabi_f2d
   \       0x28   0x0004             MOVS     R4,R0
   \       0x2A   0x000D             MOVS     R5,R1
   \       0x2C   0x6830             LDR      R0,[R6, #+0]
   \       0x2E   0x....'....        BL       __aeabi_f2d
   \       0x32   0xF05F 0x3233      MOVS     R2,#+858993459
   \       0x36   0x....             LDR.N    R3,??DataTable5_6  ;; 0x3fd33333
   \       0x38   0x....'....        BL       __aeabi_dmul
   \       0x3C   0x0022             MOVS     R2,R4
   \       0x3E   0x002B             MOVS     R3,R5
   \       0x40   0x....'....        BL       __aeabi_dadd
   \       0x44   0x....'....        BL       __aeabi_d2f
   \       0x48   0x6038             STR      R0,[R7, #+0]
     46            Encoder_Integral +=Encoder;                                       //===積分出位移  P比例
   \       0x4A   0x....             LDR.N    R4,??DataTable5_7
   \       0x4C   0x6821             LDR      R1,[R4, #+0]
   \       0x4E   0x6838             LDR      R0,[R7, #+0]
   \       0x50   0x....'....        BL       __aeabi_fadd
   \       0x54   0x6020             STR      R0,[R4, #+0]
     47            
     48            if(Encoder_Integral>27000)  	Encoder_Integral=27000;             //===積分限幅    I積分
   \       0x56   0x6820             LDR      R0,[R4, #+0]
   \       0x58   0x....             LDR.N    R1,??DataTable5_8  ;; 0x46d2f001
   \       0x5A   0x....'....        BL       __aeabi_cfrcmple
   \       0x5E   0xD801             BHI.N    ??control_velocity_0
   \       0x60   0x....             LDR.N    R0,??DataTable5_9  ;; 0x46d2f000
   \       0x62   0x6020             STR      R0,[R4, #+0]
     49            if(Encoder_Integral<-27000)	Encoder_Integral=-27000;            //===積分限幅    D微分
   \                     ??control_velocity_0: (+1)
   \       0x64   0x....             LDR.N    R1,??DataTable5_10  ;; 0xc6d2f000
   \       0x66   0x6820             LDR      R0,[R4, #+0]
   \       0x68   0x....'....        BL       __aeabi_cfcmple
   \       0x6C   0xD200             BCS.N    ??control_velocity_1
   \       0x6E   0x6021             STR      R1,[R4, #+0]
     50            if(flag_stop==1) Encoder_Integral=0,Encoder=0;
   \                     ??control_velocity_1: (+1)
   \       0x70   0x....             LDR.N    R5,??DataTable5_11
   \       0x72   0x6828             LDR      R0,[R5, #+0]
   \       0x74   0x2801             CMP      R0,#+1
   \       0x76   0xD103             BNE.N    ??control_velocity_2
   \       0x78   0x2000             MOVS     R0,#+0
   \       0x7A   0x6020             STR      R0,[R4, #+0]
   \       0x7C   0x2000             MOVS     R0,#+0
   \       0x7E   0x6038             STR      R0,[R7, #+0]
     51            
     52            Velocity=Encoder*Velocity_KP + Encoder_Integral*Velocity_KI;  //===速度控制
   \                     ??control_velocity_2: (+1)
   \       0x80   0x....             LDR.N    R6,??DataTable5_12
   \       0x82   0x....             LDR.N    R0,??DataTable5_13
   \       0x84   0x6800             LDR      R0,[R0, #+0]
   \       0x86   0x....'....        BL       __aeabi_i2f
   \       0x8A   0x6839             LDR      R1,[R7, #+0]
   \       0x8C   0x....'....        BL       __aeabi_fmul
   \       0x90   0x0007             MOVS     R7,R0
   \       0x92   0x....             LDR.N    R0,??DataTable5_14
   \       0x94   0x6800             LDR      R0,[R0, #+0]
   \       0x96   0x....'....        BL       __aeabi_i2f
   \       0x9A   0x6821             LDR      R1,[R4, #+0]
   \       0x9C   0x....'....        BL       __aeabi_fmul
   \       0xA0   0x0039             MOVS     R1,R7
   \       0xA2   0x....'....        BL       __aeabi_fadd
   \       0xA6   0x6030             STR      R0,[R6, #+0]
     53            if(flag_stop==1) Velocity=0;     
   \       0xA8   0x6828             LDR      R0,[R5, #+0]
   \       0xAA   0x2801             CMP      R0,#+1
   \       0xAC   0xD101             BNE.N    ??control_velocity_3
   \       0xAE   0x2000             MOVS     R0,#+0
   \       0xB0   0x6030             STR      R0,[R6, #+0]
     54            return Velocity;
   \                     ??control_velocity_3: (+1)
   \       0xB2   0x6830             LDR      R0,[R6, #+0]
   \       0xB4   0xBDF2             POP      {R1,R4-R7,PC}    ;; return
     55          }

   \                                 In section .bss, align 4
   \                     `control_velocity::Velocity`:
   \        0x0                      DS8 4

   \                                 In section .bss, align 4
   \                     `control_velocity::Encoder_Least`:
   \        0x0                      DS8 4

   \                                 In section .bss, align 4
   \                     `control_velocity::Encoder`:
   \        0x0                      DS8 4

   \                                 In section .bss, align 4
   \                     `control_velocity::Encoder_Integral`:
   \        0x0                      DS8 4
     56          

   \                                 In section .text, align 2, keep-with-next
     57          float control_balance_x(float angle, float Gyro){
   \                     control_balance_x: (+1)
   \        0x0   0xB5F8             PUSH     {R3-R7,LR}
   \        0x2   0x0007             MOVS     R7,R0
   \        0x4   0x000C             MOVS     R4,R1
     58            static float Bias_last, Bias_integral, Bias;
     59            int balance;
     60            Bias_last = Bias; 
   \        0x6   0x....             LDR.N    R0,??DataTable5_15
   \        0x8   0x....             LDR.N    R5,??DataTable5_16
   \        0xA   0x6829             LDR      R1,[R5, #+0]
   \        0xC   0x6001             STR      R1,[R0, #+0]
     61            Bias_integral += Bias_last;
   \        0xE   0x....             LDR.N    R6,??DataTable5_17
   \       0x10   0x6831             LDR      R1,[R6, #+0]
   \       0x12   0x6800             LDR      R0,[R0, #+0]
   \       0x14   0x....'....        BL       __aeabi_fadd
   \       0x18   0x6030             STR      R0,[R6, #+0]
     62            
     63            if(Bias_integral>4200)  	Bias_integral=4200;               //===積分限幅 4200
   \       0x1A   0x6830             LDR      R0,[R6, #+0]
   \       0x1C   0x....             LDR.N    R1,??DataTable5_18  ;; 0x45834001
   \       0x1E   0x....'....        BL       __aeabi_cfrcmple
   \       0x22   0xD801             BHI.N    ??control_balance_x_0
   \       0x24   0x....             LDR.N    R0,??DataTable5_19  ;; 0x45834000
   \       0x26   0x6030             STR      R0,[R6, #+0]
     64            if(Bias_integral<-4200)	Bias_integral=-4200;              //===積分限幅 4200 
   \                     ??control_balance_x_0: (+1)
   \       0x28   0x....             LDR.N    R1,??DataTable5_20  ;; 0xc5834000
   \       0x2A   0x6830             LDR      R0,[R6, #+0]
   \       0x2C   0x....'....        BL       __aeabi_cfcmple
   \       0x30   0xD200             BCS.N    ??control_balance_x_1
   \       0x32   0x6031             STR      R1,[R6, #+0]
     65            if(flag_stop==1) Bias_integral=0,Bias=0;
   \                     ??control_balance_x_1: (+1)
   \       0x34   0x....             LDR.N    R0,??DataTable5_11
   \       0x36   0x6800             LDR      R0,[R0, #+0]
   \       0x38   0x2801             CMP      R0,#+1
   \       0x3A   0xD103             BNE.N    ??control_balance_x_2
   \       0x3C   0x2000             MOVS     R0,#+0
   \       0x3E   0x6030             STR      R0,[R6, #+0]
   \       0x40   0x2000             MOVS     R0,#+0
   \       0x42   0x6028             STR      R0,[R5, #+0]
     66            
     67            Bias=(angle+1.5);  //=== 偏差  a 0.1 b  0.2 
   \                     ??control_balance_x_2: (+1)
   \       0x44   0x0038             MOVS     R0,R7
   \       0x46   0x....'....        BL       __aeabi_f2d
   \       0x4A   0x2200             MOVS     R2,#+0
   \       0x4C   0x....             LDR.N    R3,??DataTable5_21  ;; 0x3ff80000
   \       0x4E   0x....'....        BL       __aeabi_dadd
   \       0x52   0x....'....        BL       __aeabi_d2f
   \       0x56   0x6028             STR      R0,[R5, #+0]
     68            balance= Bias*Balance_KP + Bias_integral*Balance_Ki + Gyro*Balance_KD;
                          ^
Warning[Pa093]: implicit conversion from floating point to integer
   \       0x58   0x....             LDR.N    R0,??DataTable5_22
   \       0x5A   0x6800             LDR      R0,[R0, #+0]
   \       0x5C   0x....'....        BL       __aeabi_i2f
   \       0x60   0x6829             LDR      R1,[R5, #+0]
   \       0x62   0x....'....        BL       __aeabi_fmul
   \       0x66   0x0005             MOVS     R5,R0
   \       0x68   0x6831             LDR      R1,[R6, #+0]
   \       0x6A   0x....             LDR.N    R0,??DataTable5_23
   \       0x6C   0x6800             LDR      R0,[R0, #+0]
   \       0x6E   0x....'....        BL       __aeabi_fmul
   \       0x72   0x0029             MOVS     R1,R5
   \       0x74   0x....'....        BL       __aeabi_fadd
   \       0x78   0x0005             MOVS     R5,R0
   \       0x7A   0x....             LDR.N    R0,??DataTable5_24
   \       0x7C   0x6800             LDR      R0,[R0, #+0]
   \       0x7E   0x0021             MOVS     R1,R4
   \       0x80   0x....'....        BL       __aeabi_fmul
   \       0x84   0x0029             MOVS     R1,R5
   \       0x86   0x....'....        BL       __aeabi_fadd
   \       0x8A   0x....'....        BL       __aeabi_f2iz
     69            return balance;
   \       0x8E   0x....'....        BL       __aeabi_i2f
   \       0x92   0xBDF2             POP      {R1,R4-R7,PC}    ;; return
     70          }

   \                                 In section .bss, align 4
   \                     `control_balance_x::Bias_last`:
   \        0x0                      DS8 4

   \                                 In section .bss, align 4
   \                     `control_balance_x::Bias_integral`:
   \        0x0                      DS8 4

   \                                 In section .bss, align 4
   \                     `control_balance_x::Bias`:
   \        0x0                      DS8 4
     71          /*===============================
     72          
     73          PWM
     74          
     75          =================================*/

   \                                 In section .text, align 2, keep-with-next
     76          void Max_pwm_limit(int amplitude){
     77            if(PWM_X<-amplitude) PWM_X=-amplitude;	
   \                     Max_pwm_limit: (+1)
   \        0x0   0x....             LDR.N    R1,??DataTable5_25
   \        0x2   0x680A             LDR      R2,[R1, #+0]
   \        0x4   0x42C2             CMN      R2,R0
   \        0x6   0xDA01             BGE.N    ??Max_pwm_limit_0
   \        0x8   0x4242             RSBS     R2,R0,#+0
   \        0xA   0x600A             STR      R2,[R1, #+0]
     78            if(PWM_X>amplitude)  PWM_X=amplitude;	
   \                     ??Max_pwm_limit_0: (+1)
   \        0xC   0x680A             LDR      R2,[R1, #+0]
   \        0xE   0x4290             CMP      R0,R2
   \       0x10   0xDA00             BGE.N    ??Max_pwm_limit_1
   \       0x12   0x6008             STR      R0,[R1, #+0]
     79          }
   \                     ??Max_pwm_limit_1: (+1)
   \       0x14   0x4770             BX       LR               ;; return
     80          

   \                                 In section .text, align 2, keep-with-next
     81          void set_pwm(int pwm_x){
   \                     set_pwm: (+1)
   \        0x0   0xB510             PUSH     {R4,LR}
   \        0x2   0x0004             MOVS     R4,R0
     82            if (pwm_x<0){
   \        0x4   0x2C00             CMP      R4,#+0
   \        0x6   0xD505             BPL.N    ??set_pwm_0
     83              GPIO_SetBits(GPIOG,GPIO_Pin_13);
   \        0x8   0xF44F 0x5100      MOV      R1,#+8192
   \        0xC   0x....             LDR.N    R0,??DataTable5_26  ;; 0x40021800
   \        0xE   0x....'....        BL       GPIO_SetBits
   \       0x12   0xE004             B.N      ??set_pwm_1
     84            }
     85            else{ 
     86              //pwm_x = pwm_x+200;
     87              GPIO_ResetBits(GPIOG,GPIO_Pin_13);
   \                     ??set_pwm_0: (+1)
   \       0x14   0xF44F 0x5100      MOV      R1,#+8192
   \       0x18   0x....             LDR.N    R0,??DataTable5_26  ;; 0x40021800
   \       0x1A   0x....'....        BL       GPIO_ResetBits
     88            }
     89            pwm_x = int_abs(pwm_x);
   \                     ??set_pwm_1: (+1)
   \       0x1E   0x0020             MOVS     R0,R4
   \       0x20   0x....'....        BL       int_abs
     90            TIM8->CCR1 = pwm_x;
   \       0x24   0x....             LDR.N    R1,??DataTable5_27  ;; 0x40010434
   \       0x26   0x6008             STR      R0,[R1, #+0]
     91          }
   \       0x28   0xBD10             POP      {R4,PC}          ;; return
     92          /*===============================
     93          
     94          TIM4 interrupt - main
     95          
     96          =================================*/
     97          

   \                                 In section .bss, align 4
     98          _Time_test run_start;
   \                     run_start:
   \        0x0                      DS8 16

   \                                 In section .bss, align 4
     99          _Time_test run_stop;
   \                     run_stop:
   \        0x0                      DS8 16

   \                                 In section .text, align 2, keep-with-next
    100          void TIM5_IRQHandler(void){
   \                     TIM5_IRQHandler: (+1)
   \        0x0   0xE92D 0x41FC      PUSH     {R2-R8,LR}
    101            if(TIM5->SR&0X0001){//確認更新中斷旗標為有效
   \        0x4   0x....             LDR.N    R4,??DataTable5_28  ;; 0x40000c10
   \        0x6   0x8820             LDRH     R0,[R4, #+0]
   \        0x8   0x07C0             LSLS     R0,R0,#+31
   \        0xA   0xF140 0x809A      BPL.W    ??TIM5_IRQHandler_0
    102          //    GPIO_ToggleBits(GPIOG,GPIO_Pin_14);
    103          //    MPU6050_Get_Display();
    104              running_tim_cnt++ ;
   \        0xE   0x....             LDR.N    R0,??DataTable5
   \       0x10   0x6801             LDR      R1,[R0, #+0]
   \       0x12   0x1C49             ADDS     R1,R1,#+1
   \       0x14   0x6001             STR      R1,[R0, #+0]
    105              time_check(&run_start);                                                 //timer時間測量
   \       0x16   0x....             LDR.N    R0,??DataTable5_29
   \       0x18   0x....'....        BL       time_check
    106              
    107              get_gyro_raw();                                                         //陀螺儀raw data
   \       0x1C   0x....'....        BL       get_gyro_raw
    108              get_deg_s(&gyro_raw_f,&Mpu.deg_s);
   \       0x20   0x....             LDR.N    R6,??DataTable5_30
   \       0x22   0x....             LDR.N    R5,??DataTable5_31
   \       0x24   0x0029             MOVS     R1,R5
   \       0x26   0x0030             MOVS     R0,R6
   \       0x28   0x....'....        BL       get_deg_s
    109              get_rad_s(&gyro_raw_f,&Mpu.rad_s);
   \       0x2C   0xF115 0x010C      ADDS     R1,R5,#+12
   \       0x30   0x0030             MOVS     R0,R6
   \       0x32   0x....'....        BL       get_rad_s
    110              get_acc_raw();                                                          //加速度計raw data
   \       0x36   0x....'....        BL       get_acc_raw
    111              acc_iir_lpf(&acc_raw_f,&acc_att_lpf,Mpu.att_acc_factor);                //姿態演算法需要用的低通濾波器
   \       0x3A   0x....             LDR.N    R6,??DataTable5_32
   \       0x3C   0x6A6A             LDR      R2,[R5, #+36]
   \       0x3E   0x0031             MOVS     R1,R6
   \       0x40   0x....             LDR.N    R0,??DataTable5_33
   \       0x42   0x....'....        BL       acc_iir_lpf
    112              get_acc_g(&acc_att_lpf,&Mpu.acc_g);  
   \       0x46   0xF115 0x0118      ADDS     R1,R5,#+24
   \       0x4A   0x0030             MOVS     R0,R6
   \       0x4C   0x....'....        BL       get_acc_g
    113              //姿態演算
    114              mahony_update(Mpu.rad_s.x,Mpu.rad_s.y,Mpu.rad_s.z,Mpu.acc_g.x,Mpu.acc_g.y,Mpu.acc_g.z); 
   \       0x50   0x6A28             LDR      R0,[R5, #+32]
   \       0x52   0x9001             STR      R0,[SP, #+4]
   \       0x54   0x69E8             LDR      R0,[R5, #+28]
   \       0x56   0x9000             STR      R0,[SP, #+0]
   \       0x58   0x69AB             LDR      R3,[R5, #+24]
   \       0x5A   0x696A             LDR      R2,[R5, #+20]
   \       0x5C   0x6929             LDR      R1,[R5, #+16]
   \       0x5E   0x68E8             LDR      R0,[R5, #+12]
   \       0x60   0x....'....        BL       mahony_update
    115              Matrix_ready();                                                         //姿態演算矩陣更新                                                       //姿態演算矩陣更新
   \       0x64   0x....'....        BL       Matrix_ready
    116              
    117              encoder_x=read_Encoder_x();
   \       0x68   0x....             LDR.N    R7,??DataTable5_34
   \       0x6A   0x....'....        BL       read_Encoder_x
   \       0x6E   0x6038             STR      R0,[R7, #+0]
    118          //    encoder_y=read_Encoder_y();
    119          //    encoder_z=read_Encoder_z();
    120              
    121              velocity_pwm_x = -control_velocity(encoder_x);                          //velocity pid
   \       0x70   0x....             LDR.N    R6,??DataTable5_35
   \       0x72   0x6838             LDR      R0,[R7, #+0]
   \       0x74   0x....'....        BL       control_velocity
   \       0x78   0xF090 0x4000      EORS     R0,R0,#0x80000000
   \       0x7C   0x6030             STR      R0,[R6, #+0]
    122              balance_pwm_x = -control_balance_x(att.pit,Mpu.deg_s.x);                //balance_pid
                                   ^
Warning[Pa093]: implicit conversion from floating point to integer
   \       0x7E   0x....'....        LDR.W    R8,??DataTable5_36
   \       0x82   0x....             LDR.N    R7,??DataTable5_37
   \       0x84   0x6829             LDR      R1,[R5, #+0]
   \       0x86   0x6838             LDR      R0,[R7, #+0]
   \       0x88   0x....'....        BL       control_balance_x
   \       0x8C   0xF090 0x4000      EORS     R0,R0,#0x80000000
   \       0x90   0x....'....        BL       __aeabi_f2iz
   \       0x94   0xF8C8 0x0000      STR      R0,[R8, #+0]
    123              PWM_X =   balance_pwm_x + velocity_pwm_x ;    
                           ^
Warning[Pa093]: implicit conversion from floating point to integer
   \       0x98   0x....             LDR.N    R5,??DataTable5_25
   \       0x9A   0xF8D8 0x0000      LDR      R0,[R8, #+0]
   \       0x9E   0x....'....        BL       __aeabi_i2f
   \       0xA2   0x6831             LDR      R1,[R6, #+0]
   \       0xA4   0x....'....        BL       __aeabi_fadd
   \       0xA8   0x....'....        BL       __aeabi_f2iz
   \       0xAC   0x6028             STR      R0,[R5, #+0]
    124              
    125              if (nvic_flag == 1){
   \       0xAE   0x....             LDR.N    R0,??DataTable5_38
   \       0xB0   0x6800             LDR      R0,[R0, #+0]
   \       0xB2   0x2801             CMP      R0,#+1
   \       0xB4   0xD142             BNE.N    ??TIM5_IRQHandler_1
    126          //      if(Max_Pwm++>8300)Max_Pwm=8300;//慢慢上升
    127                Max_pwm_limit(Max_Pwm);
   \       0xB6   0x....             LDR.N    R0,??DataTable5_39
   \       0xB8   0x6800             LDR      R0,[R0, #+0]
   \       0xBA   0x....'....        BL       Max_pwm_limit
    128                
    129                if ((att.pit>=-10) && (att.pit <=10)){//balance
   \       0xBE   0x....             LDR.N    R2,??DataTable5_40  ;; 0xc1200000
   \       0xC0   0x6838             LDR      R0,[R7, #+0]
   \       0xC2   0x0011             MOVS     R1,R2
   \       0xC4   0x....'....        BL       __aeabi_cfrcmple
   \       0xC8   0xD808             BHI.N    ??TIM5_IRQHandler_2
   \       0xCA   0x6838             LDR      R0,[R7, #+0]
   \       0xCC   0x....             LDR.N    R1,??DataTable5_41  ;; 0x41200001
   \       0xCE   0x....'....        BL       __aeabi_cfcmple
   \       0xD2   0xD203             BCS.N    ??TIM5_IRQHandler_2
    130                  set_pwm(PWM_X);
   \       0xD4   0x6828             LDR      R0,[R5, #+0]
   \       0xD6   0x....'....        BL       set_pwm
   \       0xDA   0xE02F             B.N      ??TIM5_IRQHandler_1
    131                }else if(((att.pit <-10) && (att.pit >=-27)) || ((att.pit > 10) && (att.pit<=27))) {//out balance, stop wheel
   \                     ??TIM5_IRQHandler_2: (+1)
   \       0xDC   0x6838             LDR      R0,[R7, #+0]
   \       0xDE   0x0011             MOVS     R1,R2
   \       0xE0   0x....'....        BL       __aeabi_cfcmple
   \       0xE4   0xD204             BCS.N    ??TIM5_IRQHandler_3
   \       0xE6   0x6838             LDR      R0,[R7, #+0]
   \       0xE8   0x....             LDR.N    R1,??DataTable5_42  ;; 0xc1d80000
   \       0xEA   0x....'....        BL       __aeabi_cfrcmple
   \       0xEE   0xD909             BLS.N    ??TIM5_IRQHandler_4
   \                     ??TIM5_IRQHandler_3: (+1)
   \       0xF0   0x6838             LDR      R0,[R7, #+0]
   \       0xF2   0x....             LDR.N    R1,??DataTable5_41  ;; 0x41200001
   \       0xF4   0x....'....        BL       __aeabi_cfrcmple
   \       0xF8   0xD80A             BHI.N    ??TIM5_IRQHandler_5
   \       0xFA   0x6838             LDR      R0,[R7, #+0]
   \       0xFC   0x....             LDR.N    R1,??DataTable5_43  ;; 0x41d80001
   \       0xFE   0x....'....        BL       __aeabi_cfcmple
   \      0x102   0xD205             BCS.N    ??TIM5_IRQHandler_5
    132                  PWM_X = 0;
   \                     ??TIM5_IRQHandler_4: (+1)
   \      0x104   0x2000             MOVS     R0,#+0
   \      0x106   0x6028             STR      R0,[R5, #+0]
    133                  set_pwm(0);
   \      0x108   0x2000             MOVS     R0,#+0
   \      0x10A   0x....'....        BL       set_pwm
   \      0x10E   0xE015             B.N      ??TIM5_IRQHandler_1
    134                }else if(att.pit<-27){//jump up
   \                     ??TIM5_IRQHandler_5: (+1)
   \      0x110   0x6838             LDR      R0,[R7, #+0]
   \      0x112   0x....             LDR.N    R1,??DataTable5_42  ;; 0xc1d80000
   \      0x114   0x....'....        BL       __aeabi_cfcmple
   \      0x118   0xD205             BCS.N    ??TIM5_IRQHandler_6
    135                  PWM_X =-5500;
   \      0x11A   0x....             LDR.N    R0,??DataTable5_44  ;; 0xffffea84
   \      0x11C   0x6028             STR      R0,[R5, #+0]
    136                  set_pwm(PWM_X);
   \      0x11E   0x6828             LDR      R0,[R5, #+0]
   \      0x120   0x....'....        BL       set_pwm
   \      0x124   0xE00A             B.N      ??TIM5_IRQHandler_1
    137                }else if(att.pit>27){//jump up
   \                     ??TIM5_IRQHandler_6: (+1)
   \      0x126   0x6838             LDR      R0,[R7, #+0]
   \      0x128   0x....             LDR.N    R1,??DataTable5_43  ;; 0x41d80001
   \      0x12A   0x....'....        BL       __aeabi_cfrcmple
   \      0x12E   0xD805             BHI.N    ??TIM5_IRQHandler_1
    138                  PWM_X =6000;
   \      0x130   0xF241 0x7070      MOVW     R0,#+6000
   \      0x134   0x6028             STR      R0,[R5, #+0]
    139                  set_pwm(PWM_X);
   \      0x136   0x6828             LDR      R0,[R5, #+0]
   \      0x138   0x....'....        BL       set_pwm
    140                }
    141              }
    142              time_check(&run_stop);
   \                     ??TIM5_IRQHandler_1: (+1)
   \      0x13C   0x....             LDR.N    R0,??DataTable5_45
   \      0x13E   0x....'....        BL       time_check
    143            }
    144            TIM5->SR&=~(1<<0);//清除更新中斷旗標  TIM4->SR = (uint16_t)~TIM_FLAG;
   \                     ??TIM5_IRQHandler_0: (+1)
   \      0x142   0x8821             LDRH     R1,[R4, #+0]
   \      0x144   0xF64F 0x70FE      MOVW     R0,#+65534
   \      0x148   0x4001             ANDS     R1,R0,R1
   \      0x14A   0x8021             STRH     R1,[R4, #+0]
    145          }
   \      0x14C   0xE8BD 0x81F3      POP      {R0,R1,R4-R8,PC}  ;; return

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5:
   \        0x0   0x....'....        DC32     running_tim_cnt

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_1:
   \        0x0   0x4000'0C24        DC32     0x40000c24

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_2:
   \        0x0   0x3A83'126F        DC32     0x3a83126f

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_3:
   \        0x0   0x....'....        DC32     `control_velocity::Encoder_Least`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_4:
   \        0x0   0x....'....        DC32     `control_velocity::Encoder`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_5:
   \        0x0   0x3FE6'6666        DC32     0x3fe66666

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_6:
   \        0x0   0x3FD3'3333        DC32     0x3fd33333

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_7:
   \        0x0   0x....'....        DC32     `control_velocity::Encoder_Integral`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_8:
   \        0x0   0x46D2'F001        DC32     0x46d2f001

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_9:
   \        0x0   0x46D2'F000        DC32     0x46d2f000

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_10:
   \        0x0   0xC6D2'F000        DC32     0xc6d2f000

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_11:
   \        0x0   0x....'....        DC32     flag_stop

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_12:
   \        0x0   0x....'....        DC32     `control_velocity::Velocity`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_13:
   \        0x0   0x....'....        DC32     Velocity_KP

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_14:
   \        0x0   0x....'....        DC32     Velocity_KI

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_15:
   \        0x0   0x....'....        DC32     `control_balance_x::Bias_last`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_16:
   \        0x0   0x....'....        DC32     `control_balance_x::Bias`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_17:
   \        0x0   0x....'....        DC32     `control_balance_x::Bias_integral`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_18:
   \        0x0   0x4583'4001        DC32     0x45834001

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_19:
   \        0x0   0x4583'4000        DC32     0x45834000

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_20:
   \        0x0   0xC583'4000        DC32     0xc5834000

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_21:
   \        0x0   0x3FF8'0000        DC32     0x3ff80000

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_22:
   \        0x0   0x....'....        DC32     Balance_KP

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_23:
   \        0x0   0x....'....        DC32     Balance_Ki

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_24:
   \        0x0   0x....'....        DC32     Balance_KD

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_25:
   \        0x0   0x....'....        DC32     PWM_X

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_26:
   \        0x0   0x4002'1800        DC32     0x40021800

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_27:
   \        0x0   0x4001'0434        DC32     0x40010434

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_28:
   \        0x0   0x4000'0C10        DC32     0x40000c10

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_29:
   \        0x0   0x....'....        DC32     run_start

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_30:
   \        0x0   0x....'....        DC32     gyro_raw_f

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_31:
   \        0x0   0x....'....        DC32     Mpu

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_32:
   \        0x0   0x....'....        DC32     acc_att_lpf

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_33:
   \        0x0   0x....'....        DC32     acc_raw_f

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_34:
   \        0x0   0x....'....        DC32     encoder_x

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_35:
   \        0x0   0x....'....        DC32     velocity_pwm_x

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_36:
   \        0x0   0x....'....        DC32     balance_pwm_x

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_37:
   \        0x0   0x....'....        DC32     att

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_38:
   \        0x0   0x....'....        DC32     nvic_flag

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_39:
   \        0x0   0x....'....        DC32     Max_Pwm

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_40:
   \        0x0   0xC120'0000        DC32     0xc1200000

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_41:
   \        0x0   0x4120'0001        DC32     0x41200001

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_42:
   \        0x0   0xC1D8'0000        DC32     0xc1d80000

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_43:
   \        0x0   0x41D8'0001        DC32     0x41d80001

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_44:
   \        0x0   0xFFFF'EA84        DC32     0xffffea84

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5_45:
   \        0x0   0x....'....        DC32     run_stop

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       0   Max_pwm_limit
      32   TIM5_IRQHandler
        32   -> Matrix_ready
        32   -> Max_pwm_limit
        32   -> __aeabi_f2iz
        32   -> __aeabi_fadd
        32   -> __aeabi_i2f
        32   -> acc_iir_lpf
        32   -> control_balance_x
        32   -> control_velocity
        32   -> get_acc_g
        32   -> get_acc_raw
        32   -> get_deg_s
        32   -> get_gyro_raw
        32   -> get_rad_s
        32   -> mahony_update
        32   -> read_Encoder_x
        32   -> set_pwm
        32   -> time_check
        32 __aeabi_cfcmple
        32 __aeabi_cfrcmple
      24   control_balance_x
        24   -> __aeabi_d2f
        24   -> __aeabi_dadd
        24   -> __aeabi_f2d
        24   -> __aeabi_f2iz
        24   -> __aeabi_fadd
        24   -> __aeabi_fmul
        24   -> __aeabi_i2f
        24 __aeabi_cfcmple
        24 __aeabi_cfrcmple
      24   control_velocity
        24   -> __aeabi_d2f
        24   -> __aeabi_dadd
        24   -> __aeabi_dmul
        24   -> __aeabi_f2d
        24   -> __aeabi_fadd
        24   -> __aeabi_fmul
        24   -> __aeabi_i2f
        24 __aeabi_cfcmple
        24 __aeabi_cfrcmple
       8   set_pwm
         8   -> GPIO_ResetBits
         8   -> GPIO_SetBits
         8   -> int_abs
       8   time_check
         8   -> __aeabi_fmul
         8   -> __aeabi_fsub
         8   -> __aeabi_ui2f


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable5
       4  ??DataTable5_1
       4  ??DataTable5_10
       4  ??DataTable5_11
       4  ??DataTable5_12
       4  ??DataTable5_13
       4  ??DataTable5_14
       4  ??DataTable5_15
       4  ??DataTable5_16
       4  ??DataTable5_17
       4  ??DataTable5_18
       4  ??DataTable5_19
       4  ??DataTable5_2
       4  ??DataTable5_20
       4  ??DataTable5_21
       4  ??DataTable5_22
       4  ??DataTable5_23
       4  ??DataTable5_24
       4  ??DataTable5_25
       4  ??DataTable5_26
       4  ??DataTable5_27
       4  ??DataTable5_28
       4  ??DataTable5_29
       4  ??DataTable5_3
       4  ??DataTable5_30
       4  ??DataTable5_31
       4  ??DataTable5_32
       4  ??DataTable5_33
       4  ??DataTable5_34
       4  ??DataTable5_35
       4  ??DataTable5_36
       4  ??DataTable5_37
       4  ??DataTable5_38
       4  ??DataTable5_39
       4  ??DataTable5_4
       4  ??DataTable5_40
       4  ??DataTable5_41
       4  ??DataTable5_42
       4  ??DataTable5_43
       4  ??DataTable5_44
       4  ??DataTable5_45
       4  ??DataTable5_5
       4  ??DataTable5_6
       4  ??DataTable5_7
       4  ??DataTable5_8
       4  ??DataTable5_9
       4  Balance_KD
       4  Balance_KP
       4  Balance_Ki
       4  Bias
       4  Bias_integral
       4  Bias_last
       4  Encoder
       4  Encoder_Integral
       4  Encoder_Least
       4  Max_Pwm
      22  Max_pwm_limit
       4  PWM_X
     336  TIM5_IRQHandler
       4  Velocity
       4  Velocity_KI
       4  Velocity_KP
       4  balance_pwm_x
     148  control_balance_x
     182  control_velocity
       4  encoder_x
       4  encoder_y
       4  encoder_z
       4  flag_stop
       4  nvic_flag
      16  run_start
      16  run_stop
       4  running_tim_cnt
      42  set_pwm
      52  time_check
       4  velocity_pwm_x

 
 100 bytes in section .bss
  20 bytes in section .data
 966 bytes in section .text
 
 966 bytes of CODE memory
 120 bytes of DATA memory

Errors: none
Warnings: 4
